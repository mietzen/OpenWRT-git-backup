#!/bin/sh /etc/rc.common

START=99
STOP=1
PROG=/usr/local/bin/git_backup
PIDFILE=/var/run/git_backup.pid
LOGFILE=/var/log/git_backup.log

start() {
    echo "Starting git backup service..."
    # -S: start
    # -b: background
    # -m: create PID file
    # -x: execute the program
    # -p: use this PID file
    start-stop-daemon -S -b -m -x $PROG -p $PIDFILE >> $LOGFILE 2>&1
}

stop() {
    echo "Stopping git backup service..."
    # -K: stop (kill)
    # -q: quiet (suppress common errors)
    # -p: use this PID file to find the process
    # -s TERM: use SIGTERM for graceful shutdown first
    start-stop-daemon -K -q -p $PIDFILE -s TERM

    # Wait a moment for graceful shutdown
    sleep 2

    # Force kill if still running
    start-stop-daemon -K -q -p $PIDFILE -s KILL 2>/dev/null

    # Clean up PID file
    rm -f $PIDFILE
}

# The 'restart' function is provided by /etc/rc.common when using start() and stop()
